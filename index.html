<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Splitwise</title>
</head>
<body>
    <h1>Expense Tracker</h1>

    <form id="expenseForm">
        <input type="text" id="desc" placeholder="Description" required />
        <input type="number" step="0.01" id="amount" placeholder="Amount" required />
        <select id="paidBy">
            <option value="me">KEVIN</option>
            <option value="gf">JACKIE</option>
        </select>
        <input type="date" id="date" />
        <button type="submit">Add</button>
    </form>

    <h2>Expenses</h2>
    <ul id="expensesList"></ul>

    <h2>Balance Summary</h2>
    <p id="balanceResult">Loading...</p>

    <script>
        const form = document.getElementById('expenseForm');
        const list = document.getElementById('expensesList');
        const dateInput = document.getElementById('date');
        const today = new Date().toISOString().split('T')[0];
        dateInput.value = today;

        async function fetchExpenses() {
            const res = await fetch('http://127.0.0.1:5000/api/expenses');
            const data = await res.json();
            list.innerHTML = '';
            data.forEach(exp => {
                const item = document.createElement('li');
                item.textContent = `${exp.description} - $${exp.amount} paid by ${exp.paid_by}, split ${exp.split_between.join(" & ")} on ${exp.date}`;
                list.appendChild(item);
            });
        }

        async function fetchBalance() {
            const res = await fetch('http://127.0.0.1:5000/api/balance');
            const data = await res.json();
            document.getElementById('balanceResult').textContent = data.verdict;
        }

        async function refreshAll() {
            await fetchExpenses();
            await fetchBalance();
        }

        form.addEventListener('submit', async e => {
            e.preventDefault();
            const body = {
                description: document.getElementById('desc').value,
                amount: document.getElementById('amount').value,
                paid_by: document.getElementById('paidBy').value,
                date: document.getElementById('date').value
            };
            await fetch('http://127.0.0.1:5000/api/expenses', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });
            form.reset();
            dateInput.value = today;
            refreshAll();
        });

        refreshAll();
    </script>
</body>
</html>
